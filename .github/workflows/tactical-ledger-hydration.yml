name: "üí† Hydra Genesis: Tactical Ledger Hydration"

on:
  workflow_dispatch:

jobs:
  ignition:
    name: "Crystallizing Genesis Strata"
    runs-on: ubuntu-latest
    # Eliminamos 'environment: main' para usar los secretos globales del repo

    steps:
      - name: "üõ∞Ô∏è [1/4] Adquiring Source Code"
        uses: actions/checkout@v4

      - name: "Crabe [2/4] Initializing Rust Toolchain"
        uses: dtolnay/rust-toolchain@nightly

      - name: "üß¨ [4/4] Executing Atomic Seed Sequence (Release Mode)"
        env:
          # Mapeo directo desde Repository Secrets
          DATABASE_URL: ${{ secrets.DATABASE_URL }}
          TURSO_AUTH_TOKEN: ${{ secrets.TURSO_AUTH_TOKEN }}
          WORKER_AUTH_TOKEN: ${{ secrets.WORKER_AUTH_TOKEN }}
          GITHUB_PAT: ${{ secrets.GB_PAT }}

          # Mapeo directo desde Repository Variables
          GITHUB_OWNER: ${{ vars.GB_OWNER }}
          GITHUB_REPO: ${{ vars.GB_REPO }}
          ORCHESTRATOR_URL: ${{ vars.ORCHESTRATOR_URL }}
          FILTER_BASE_URL: ${{ vars.FILTER_BASE_URL }}
          FILTER_SHARDS: ${{ vars.FILTER_SHARDS }}
          RUST_LOG: info
        run: |
          echo "Building and firing Seeder V180.5..."
          # Verificaci√≥n de integridad de inyecci√≥n
          if [ -z "$DATABASE_URL" ]; then echo "‚ùå FATAL: DATABASE_URL is empty. Check Repository Secrets."; exit 1; fi
          cargo run --release --bin seed
