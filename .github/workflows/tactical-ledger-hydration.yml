name: "ðŸ’  Hydra Genesis: Tactical Ledger Hydration"

on:
  workflow_dispatch:
    inputs:
      reason:
        description: 'Mando Protocol'
        required: true
        default: 'MANUAL_GENESIS_IGNITION'

jobs:
  ignition:
    name: "Crystallizing Genesis Strata"
    runs-on: ubuntu-latest
    # ðŸ›¡ï¸ CRÃTICO: Especificamos el entorno donde usted creÃ³ los secretos/variables
    environment: main

    concurrency:
      group: ledger-hydration
      cancel-in-progress: false

    steps:
      - name: "ðŸ›°ï¸ [1/4] Adquiring Source Code"
        uses: actions/checkout@v4

      - name: "ðŸ¦€ [2/4] Initializing Rust Toolchain"
        uses: dtolnay/rust-toolchain@nightly

      - name: "ðŸ“¦ [3/4] Synchronizing Binary Cache"
        uses: Swatinem/rust-cache@v2

      - name: "ðŸ§¬ [4/4] Executing Atomic Seed Sequence (Release Mode)"
        env:
          # --- MAPEO DE SECRETOS (GB -> SISTEMA) ---
          DATABASE_URL: ${{ secrets.DATABASE_URL }}
          TURSO_AUTH_TOKEN: ${{ secrets.TURSO_AUTH_TOKEN }}
          WORKER_AUTH_TOKEN: ${{ secrets.WORKER_AUTH_TOKEN }}
          GITHUB_PAT: ${{ secrets.GB_PAT }}

          # --- MAPEO DE VARIABLES (GB -> SISTEMA) ---
          GITHUB_OWNER: ${{ vars.GB_OWNER }}
          GITHUB_REPO: ${{ vars.GB_REPO }}
          ORCHESTRATOR_URL: ${{ vars.ORCHESTRATOR_URL }}
          FILTER_BASE_URL: ${{ vars.FILTER_BASE_URL }}
          FILTER_SHARDS: ${{ vars.FILTER_SHARDS }}

          RUST_LOG: info
        run: |
          echo "Building and firing Seeder with GB_Strata mapping..."
          cargo run --release --bin seed
